# This script will attempt to apply a quadtree based intersection on a list of points.
try:
    from osgeo import ogr, osr, gdal
except:
    sys.exit('ERROR: cannot find GDAL/OGR modules')

def gdal_error_handler(err_class, err_num, err_msg):
    errtype = {
            gdal.CE_None:'None',
            gdal.CE_Debug:'Debug',
            gdal.CE_Warning:'Warning',
            gdal.CE_Failure:'Failure',
            gdal.CE_Fatal:'Fatal'
    }
    err_msg = err_msg.replace('\n',' ')
    err_class = errtype.get(err_class, 'None')
    print 'Error Number: %s' % (err_num)
    print 'Error Type: %s' % (err_class)
    print 'Error Message: %s' % (err_msg)


try:
    import csv, pyqtree

wgs = osr.SpatialReference()
wgs.ImportFromEPSG(4326)

# This is the coordinate system used for the plot measurements
# This example uses UTM zone 12N, will need to parameterize this
utm = osr.SpatialReference()
utm.ImportFromEPSG(32612)

transform = osr.CoordinateTransformation(wgs, utm)
pointDataSource = ogr.Open("cc.vrt")
print pointDataSource.__len__()
lyr = pointDataSource.GetLayer(0)
#print lyr
for feat in lyr:
    geom = feat.GetGeometryRef()
    geom.Transform(transform)
    print feat
    #print geom.ExportToWkt()
